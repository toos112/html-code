<html>
	<head>
		<title>
			Chat
		</title>
		<script>
			var ws = new WebSocket("ws://" + location.host, "chat");
			ws.onmessage = function(e) {
				var htmlChat = document.getElementById("chat");
				htmlChat.innerHTML += e.data + "<br/>";
				htmlChat.scrollTop = htmlChat.scrollHeight;
			};
			
			function enterPress(e) {
				if (e.keyCode == 13) {
					send();
				}
			}
			
			function send() {
				var htmlName = document.getElementById("name");
				var htmlMessage = document.getElementById("message");
				var htmlChat = document.getElementById("chat");
				var sender = "";
				var senderOld = "";
				if (htmlName.value == "") {
					sender = "Anonymous";
				} else {
					sender = htmlName.value;
				}
				if (htmlMessage.value != "") {
					if (sender == senderOld) {
						ws.send(":" + htmlMessage.value);
					} else {
						senderOld = sender;
						ws.send("@" + sender);
						ws.send(":" + htmlMessage.value);
					}
					htmlMessage.value = "";
				}
			}
		</script>
		<link rel = "stylesheet" type = "text/css" href = "index.css">
	</head>
	<body>
		<h1 class = "title" >
			Chat
		</h1>
		<div class = "chat" id = "chat"> (js:
			_.I("_scripts/file.js");
			ret = $file.read("data/chat.txt").join("<br/>") + "<br/>";
		:js)</div>
		<div id = "send">
			<span id = "nameText">Name: </span><input type = "text" name = "name" id = "name" placeholder = "Type your Name here">
			<span id = "messageText">Message: </span><input type = "text" name = "message" id = "message" placeholder = "Type your Message here" onkeydown = "enterPress(event);"> 
			<button type = "button" onclick = "send();" id = "button">Send</button>
		</div>
	</body>
</html>