<!DOCTYPE html>
<html>
	<head>
		<title>
			Chat
		</title>
		<script>
			var ws = new WebSocket("ws://" + location.host, "chat");
			ws.onmessage = function(e) {
				var htmlChat = document.getElementById("chat");
				htmlChat.innerHTML += e.data + "<br/>";
				htmlChat.scrollTop = htmlChat.scrollHeight;
			};
			
			function enterPress(e) {
				if (e.keyCode == 13) {
					send();
				}
			}
			
			function send() {
				var htmlName = document.getElementById("name");
				var htmlMessage = document.getElementById("message");
				var sender = "";
				var senderOld = "";
				if (htmlName.value == "") {
					sender = "Anonymous";
				} else {
					sender = htmlName.value;
				}
				if (htmlMessage.value != "") {
					if (sender == senderOld) {
						ws.send(":" + htmlMessage.value);
					} else {
						senderOld = sender;
						ws.send("@" + sender);
						ws.send(":" + htmlMessage.value);
					}
					htmlMessage.value = "";
				}
			}
		</script>
		<link rel = "stylesheet" type = "text/css" href = "index.css">
	</head>
	<body style = "padding : 5px; background : linear-gradient(to bottom, #222, #666);">
		<span class = "big center" style = "width : 100%; color : #f00; margin-bottom: 5px;">
			Chat
		</span><br/>
		<span style = "padding: 5px; width: calc(100% - 20px); height: calc(100% - 102px); overflow: auto; background-color: #222;" id = "chat">
			(js:
				_.I("_scripts/file.js");
				ret = $file.read("data/chat.txt").join("<br/>") + "<br/>";
			:js)
		</span><br/>
		<div id = "send" style = "margin-top: 5px; width: calc(100% - 10px); height: 24px;">
			<span class = "center" id = "nameText" style = "width : 80px;">
				Name: 
			</span>
			<input type = "text" id = "name" placeholder = "Type your Name here" style = "width: 256px; margin-left: 5px;"/>
			<span class = "center" id = "messageText" style = "width : 128px; margin-left: 5px;">
				Message: 
			</span>
			<input type = "text" id = "message" placeholder = "Type your Message here" onkeydown = "enterPress(event);" style = "width: calc(100% - 612px); margin-left: 5px;"/> 
			<button type = "button" onclick = "send();" id = "button" style = "margin-left: 5px;">
				<span>
					Send
				</span>
			</button>
		</div>
	</body>
</html>