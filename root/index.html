<html>
	<head>
		<title>
			Chat
		</title>
		<script>
			var ws = new WebSocket("ws://" + location.host, "chat");
			ws.onmessage = function(e) {
				var htmlChat = document.getElementById("chat");
				var chatSpan = htmlChat.getElementsByTagName("span")[0];
				chatSpan.innerHTML += e.data + "<br/>";
				chatSpan.scrollTop = chatSpan.scrollHeight;
			};
			
			function enterPress(e) {
				if (e.keyCode == 13) {
					send();
				}
			}
			
			function send() {
				var htmlName = document.getElementById("name");
				var htmlMessage = document.getElementById("message");
				var htmlChat = document.getElementById("chat");
				var sender = "";
				var senderOld = "";
				if (htmlName.value == "") {
					sender = "Anonymous";
				} else {
					sender = htmlName.value;
				}
				if (htmlMessage.value != "") {
					if (sender == senderOld) {
						ws.send(":" + htmlMessage.value);
					} else {
						senderOld = sender;
						ws.send("@" + sender);
						ws.send(":" + htmlMessage.value);
					}
					htmlMessage.value = "";
				}
			}
		</script>
		<link rel = "stylesheet" type = "text/css" href = "index.css">
	</head>
	<body>
		<span class = "big center" style = "width: 100%">
			Chat
		</span><br>
		<div style = "width: 100%; height: calc(100% - 72px)" id = "chat"><span style = "width: 100%; height: 100%; overflow: auto;">(js:
			_.I("_scripts/file.js");
			ret = $file.read("data/chat.txt").join("<br/>") + "<br/>";
		:js)</span></div><br>
		<div id = "send" style = "width: 100%; height: 24px;">
			<span class = "center" id = "nameText" style = "width: 80px;">Name: </span><input type = "text" id = "name" placeholder = "Type your Name here" style = "width: 256px;">
			<span class = "center" id = "messageText" style = "width: 128px;">Message: </span><input type = "text" id = "message" placeholder = "Type your Message here" onkeydown = "enterPress(event);" style = "width: calc(100% - 592px);"> 
			<button type = "button" onclick = "send();" id = "button"><span>Send</span></button>
		</div>
	</body>
</html>